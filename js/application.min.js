// # Some of application.js, bpm-delay.js, knob.js,
// waveshaper.js and wavetable.js:
//
// Copyright 2012, Google Inc.
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are
// met:
//
//     * Redistributions of source code must retain the above copyright
// notice, this list of conditions and the following disclaimer.
//     * Redistributions in binary form must reproduce the above
// copyright notice, this list of conditions and the following disclaimer
// in the documentation and/or other materials provided with the
// distribution.
//     * Neither the name of Google Inc. nor the names of its
// contributors may be used to endorse or promote products derived from
// this software without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// # Plus fft.js:
//
// Copyright (c) 2010 Corban Brook, released under the MIT license
// Fourier Transform Module used by DFT, FFT, RFT
// Slightly modified for packed DC/nyquist...
function getElementCoordinates(e,t){var n=getAbsolutePosition(e);n.x=t.x-n.x;n.y=t.y-n.y;var r=n;if(isNaN(n.y)){var i={event:t,element:e};r=getRelativeCoordinates(i)}return r}function getAbsolutePosition(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var n=getAbsolutePosition(e.offsetParent);t.x+=n.x;t.y+=n.y}return t}function getRelativeCoordinates(e,t){var n,r,i=e.event,s=e.element,o=t||e.element;if(!window.opera&&typeof i.offsetX!="undefined"){var u={x:i.offsetX,y:i.offsetY},a=s;while(a){a.mouseX=u.x;a.mouseY=u.y;u.x+=a.offsetLeft;u.y+=a.offsetTop;a=a.offsetParent}var a=o,f={x:0,y:0};while(a){if(typeof a.mouseX!="undefined"){n=a.mouseX-f.x;r=a.mouseY-f.y;break}f.x+=a.offsetLeft;f.y+=a.offsetTop;a=a.offsetParent}a=s;while(a){a.mouseX=undefined;a.mouseY=undefined;a=a.offsetParent}}else{var u=getAbsolutePosition(o);n=i.pageX-u.x;r=i.pageY-u.y}return{x:n,y:r}}function addSlider(e){var t=document.getElementById("controls"),n=e+"Slider",r='<div style="width:500px; height:20px;"> <input id="'+n+'" '+'type="range" min="0" max="1" step="0.01" value="0" style="height: 20px; width: 450px;"> <div id="'+e+'-value" style="position:relative; left:30em; top:-18px;">'+e+"</div> </div> <br>  ";t.innerHTML=t.innerHTML+r}function configureSlider(e,t,n,r,i){var s=e+"Slider",o=document.getElementById(s);o.min=n;o.max=r;o.value=t;o.onchange=function(){i(0,this)}}function addSliderOld(e){var t=document.getElementById("controls"),n=e+"Slider",r='<div id="'+n+'" style="width:500px;"> <div id="'+e+'-value" style="position:relative; left:30em;">'+e+"</div> </div> <br>  ";t.innerHTML=t.innerHTML+r}function configureSliderOld(e,t,n,r,i){var s=document.getElementById("controls"),o=e+"Slider",u=$("#"+o);u.slider({min:n});u.slider("option","max",r);u.slider("option","step",.001);u.slider("value",t);u.bind("slide",i)}function FourierTransform(e,t){this.bufferSize=e;this.sampleRate=t;this.bandwidth=2/e*t/2;this.spectrum=new Float32Array(e/2);this.real=new Float32Array(e);this.imag=new Float32Array(e);this.peakBand=0;this.peak=0;this.getBandFrequency=function(e){return this.bandwidth*e+this.bandwidth/2};this.calculateSpectrum=function(){var t=this.spectrum,n=this.real,r=this.imag,i=2/this.bufferSize,s=Math.sqrt,o,u,a;for(var f=0,l=e/2;f<l;f++){o=n[f];u=r[f];a=i*s(o*o+u*u);if(a>this.peak){this.peakBand=f;this.peak=a}t[f]=a}}}function FFT(e,t){FourierTransform.call(this,e,t);this.reverseTable=new Uint32Array(e);var n=1,r=e>>1,i;while(n<e){for(i=0;i<n;i++)this.reverseTable[i+n]=this.reverseTable[i]+r;n<<=1;r>>=1}this.sinTable=new Float32Array(e);this.cosTable=new Float32Array(e);for(i=0;i<e;i++){this.sinTable[i]=Math.sin(-Math.PI/i);this.cosTable[i]=Math.cos(-Math.PI/i)}}function BpmDelay(e){this.delay=e.createDelayNode();this.context=e;this.tempo=120;this.noteDivision=times[6];this.updateDelayTime()}function e4(e,t){return 1-Math.exp(-t*e)}function dBToLinear(e){return Math.pow(10,.05*e)}function shape(e){var t=dBToLinear(threshold),n=dBToLinear(headroom),r=1.05*n*t,i=r-t,s=e<0?-1:1,o=Math.abs(e),u=o<t?o:t+i*e4(o-t,1/i);u*=s;return u}function generateColortouchCurve(e){var t=65536,n=t/2;for(var r=0;r<n;++r){x=r/n;x=shape(x);e[n+r]=x;e[n-r-1]=-x}return e}function WaveShaper(e){this.context=e;var t=e.createWaveShaper(),n=e.createGainNode(),r=e.createGainNode();n.connect(t);t.connect(r);this.input=n;this.output=r;var i=new Float32Array(65536);generateColortouchCurve(i);t.curve=i}function WaveTable(e,t){this.name=e;this.context=t;this.sampleRate=t.sampleRate;this.url="wave-tables/"+this.name;this.waveTableSize=4096;this.buffer=0;this.numberOfResampleRanges=kDefaultNumberOfResampleRanges}function KnobView(e,t,n,r,i,s,o,u){this.name=e;this.value=t;this.minValue=n;this.maxValue=r;this.units=i;this.useLogScale=o;this.precision=s;this.preValue=this.valueToPre(t);this.onchange=u;this.backgroundColor="rgb(60,40,40)";this.knobColor="rgb(200,150,150)";this.knobOutlineColor="rgb(255,255,255)";this.valueIndicatorColor="rgb(80,100,100)";this.textColor="rgb(255,255,255)"}function installViews(e,t){var n="";for(var r=0;r<e.length;++r){var i=e[r],s='<canvas id="';s+=i.name;s+='" width="260" height="24"> </canvas>';n+=s}t.innerHTML=n;for(var r=0;r<e.length;++r){var i=e[r];i.attach()}}function onDocumentKeyDown(e){switch(e.keyCode){case 16:isShiftDown=!0;break;case 18:isAltDown=!0}window.console.log(sequence.rhythm)}function onDocumentKeyUp(e){switch(e.keyCode){case 16:isShiftDown=!1;break;case 18:isAltDown=!1}}function loadWaveTables(){loader=new WaveTableLoader;loader.load(start)}function WaveTableLoader(){this.waveNames=["01_Saw","02_Triangle","03_Square","04_Noise","05_Pulse","06_Warm_Saw","07_Warm_Triangle","08_Warm_Square","09_Dropped_Saw","10_Dropped_Square","11_TB303_Square","Bass","Bass_Amp360","Bass_Fuzz","Bass_Fuzz_ 2","Bass_Sub_Dub","Bass_Sub_Dub_2","Brass","Brit_Blues","Brit_Blues_Driven","Buzzy_1","Buzzy_2","Celeste","Chorus_Strings","Dissonant Piano","Dissonant_1","Dissonant_2","Dyna_EP_Bright","Dyna_EP_Med","Ethnic_33","Full_1","Full_2","Guitar_Fuzz","Harsh","Mkl_Hard","Organ_2","Organ_3","Phoneme_ah","Phoneme_bah","Phoneme_ee","Phoneme_o","Phoneme_ooh","Phoneme_pop_ahhhs","Piano","Putney_Wavering","Throaty","Trombone","Twelve String Guitar 1","Twelve_OpTines","Wurlitzer","Wurlitzer_2"]}function SequenceView(e,t){this.sequence=e;this.name=t;this.numberOfNotes=e.loopLength;this.numSemitones=60;this.backgroundColor="rgb(60,40,40)";this.noteColor="rgb(200,150,150)";this.gridColor="rgb(255,255,255)";this.playheadColor="rgb(255,255,224)";this.canvas=document.getElementById(t);this.ctx=this.canvas.getContext("2d");this.width=this.canvas.width;this.height=this.canvas.height;var n=this,r=this.canvas;r.addEventListener("mousedown",function(e){var t={event:e,element:n.canvas},r=getRelativeCoordinates(t);currentView=n;n.isDragging=!0;n.startPosition=r;n.mouseDown(r)},!0);document.addEventListener("mousemove",function(e){if(currentView&&currentView==n){var t=getAbsolutePosition(currentView.canvas);t.x=e.x-t.x;t.y=e.y-t.y;var r=t;if(isNaN(t.y)){var i={event:e,element:currentView.canvas};r=getRelativeCoordinates(i)}currentView.mouseMove(r)}},!0);document.addEventListener("mouseup",function(e){if(currentView&&currentView==n){n.isDragging=!1;var t={event:e,element:currentView.canvas},r=getRelativeCoordinates(t);currentView.mouseUp(r);currentView=0}},!0);this.draw();this.drawPlayhead()}function Sequence(){this.loopLength=16;this.rhythmIndex=0;this.lastRhythmIndex=-1;this.loopNumber=0;this.noteTime=0;this.rhythm=[4,4,4,-1,8,13,25,15,33,23,11,-1,0,-1,3,-1]}function ddd(){sequence.schedule()}function Note(e,t){this.staticAudioRouting=e;this.isMonophonic=t;var n=context.createBufferSource();n.looping=!0;var r=context.createBufferSource();r.looping=!0;var i=context.createBufferSource();i.looping=!0;var s=context.createBufferSource();s.looping=!0;var o=context.createPanner();o.panningModel=webkitAudioPannerNode.EQUALPOWER;var u=context.createPanner();u.panningModel=webkitAudioPannerNode.EQUALPOWER;var a=context.createGainNode();a.gain.value=0;var f=context.createBiquadFilter();f.type=0;f.gain.value=0;var l=context.createGainNode();l.gain.value=0;n.connect(o);r.connect(o);i.connect(u);s.connect(u);o.connect(a);u.connect(a);a.connect(f);f.connect(l);l.connect(this.staticAudioRouting.subsonicFilter);if(this.isMonophonic){n.noteOn(0);i.noteOn(0);r.noteOn(0);s.noteOn(0)}this.osc1=n;this.osc2=i;this.osc1Octave=r;this.osc2Octave=s;this.panner1=o;this.panner2=u;this.ampEnvelope=a;this.filter=f;this.noteVolume=l;this.wave=0;this.wave2=0}function setTempo(e){tempo=e;bpmDelay.setTempo(tempo)}function loadImpulseResponse(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0);n.responseType="arraybuffer";n.onload=function(){t.buffer=context.createBuffer(n.response,!1);isImpulseResponseLoaded=!0};n.onerror=function(){alert("error loading reverb")};n.send()}function StaticAudioRouting(){var e=context.createDynamicsCompressor();e.connect(context.destination);var t=context.createConvolver(),n=context.createGainNode(),r=context.createGainNode();n.connect(e);r.connect(t);t.connect(e);bpmDelay=new BpmDelay(context);var i=context.createGainNode(),s=context.createGainNode(),o=context.createGainNode();i.gain.value=.5;s.gain.value=.5;o.gain.value=.5;s.connect(e);bpmDelay.delay.connect(o);o.connect(e);bpmDelay.delay.connect(i);delayWaveShaper=new WaveShaper(context);i.connect(delayWaveShaper.input);delayWaveShaper.output.connect(bpmDelay.delay);grungeWaveShaper=new WaveShaper(context);grungeWaveShaper.output.connect(s);grungeWaveShaper.output.connect(bpmDelay.delay);grungeWaveShaper.output.connect(n);grungeWaveShaper.output.connect(r);var u=context.createBiquadFilter();u.type=1;u.frequency.value=10;u.connect(grungeWaveShaper.input);this.compressor=e;this.convolver=t;this.convolverDry=n;this.convolverWet=r;this.bpmDelay=bpmDelay;this.delayFeedback=i;this.delayDry=s;this.delayWet=o;this.delayWaveShaper=delayWaveShaper;this.grungeWaveShaper=grungeWaveShaper;this.subsonicFilter=u;this.setReverbDryWet(.2)}function init(){context=new webkitAudioContext;staticAudioRouting=new StaticAudioRouting;monophonicNote=new Note(staticAudioRouting,!0);loadWaveTables();document.addEventListener("keydown",onDocumentKeyDown,!1);document.addEventListener("keyup",onDocumentKeyUp,!1);sequence=new Sequence;addUI()}function setWaveTable1(e){waveTable=loader.getTable(e);waveTable2=loader.getTable(e)}function setWaveTable2(e){waveTable2=loader.getTable(e)}function addUI(){var e=document.getElementById("controls");views=new Array;var t=0;views[t++]=new KnobView("cutoff",cutoff,0,1,UNITS.generic,1,!1,function(e){cutoff=e});views[t++]=new KnobView("resonance",resonance,0,40,UNITS.decibels,1,!1,function(e){resonance=e});views[t++]=new KnobView("envAmount",envAmount,0,1,UNITS.generic,2,!1,function(e){envAmount=e});views[t++]=new KnobView("filterAttack",filterAttack,.004,.2,UNITS.seconds,3,!1,function(e){filterAttack=e});views[t++]=new KnobView("filterDecay",filterDecay,.004,.3,UNITS.seconds,3,!1,function(e){filterDecay=e});views[t++]=new KnobView("ampAttack",ampAttack,.005,.3,UNITS.seconds,3,!0,function(e){ampAttack=e});views[t++]=new KnobView("ampDecay",ampDecay,.001,5,UNITS.seconds,3,!0,function(e){ampDecay=e});views[t++]=new KnobView("width",width,0,1,UNITS.generic,1,!1,function(e){width=e});views[t++]=new KnobView("detune1",detune1,-50,50,UNITS.cents,1,!1,function(e){detune1=e});views[t++]=new KnobView("detune2",detune2,-50,50,UNITS.cents,1,!1,function(e){detune2=e});views[t++]=new KnobView("osc2 octave",octave,0,4,UNITS.indexed,0,!1,function(e){octave=e});views[t++]=new KnobView("tempo",tempo,50,240,UNITS.bpm,1,!1,function(e){setTempo(e)});views[t++]=new KnobView("subsonic cutoff",10,5,2e3,UNITS.hertz,0,!0,function(e){subsonicFilter.frequency.value=e});views[t++]=new KnobView("reverb dry/wet",20,0,100,UNITS.percent,1,!1,function(e){staticAudioRouting.setReverbDryWet(.01*e)});views[t++]=new KnobView("delay dry/wet",50,0,100,UNITS.percent,1,!1,function(e){staticAudioRouting.setDelayDryWet(.01*e)});views[t++]=new KnobView("delay feedback",50,0,100,UNITS.percent,1,!1,function(e){staticAudioRouting.setDelayFeedback(.01*e)});views[t++]=new KnobView("delay grunge",0,-10,30,UNITS.decibels,1,!1,function(e){staticAudioRouting.setDelayGrunge(e)});views[t++]=new KnobView("main grunge",0,-15,50,UNITS.decibels,1,!1,function(e){staticAudioRouting.setMainGrunge(e)});views[t++]=new KnobView("volume",volume,0,1,UNITS.generic,1,!1,function(e){volume=e});installViews(views,e);sequenceView=new SequenceView(sequence,"sequenceView");bpmDelay.setDelayValue("quarter note");var n=document.getElementById("bpmDelayMenu"),r='Delay: <select onchange="bpmDelay.setDelayValue(this.value);">';r+="<option>32nd note</option>";r+="<option>16th note triplet</option>";r+="<option>dotted 32nd note</option>";r+="<option>16th note</option>";r+="<option>8th note triplet</option>";r+="<option>dotted 16th note</option>";r+="<option>8th note</option>";r+="<option>quarter note triplet</option>";r+="<option>dotted eighth note</option>";r+="<option selected>quarter note</option>";r+="</select>";n.innerHTML=r;loader.makeWavePopup("wavePopup1")}function start(){var e=document.getElementById("loading");e.innerHTML="";startTime=context.currentTime+.16;waveTable=loader.getTable(defaultWaveTableName);waveTable2=loader.getTable(defaultWaveTableName);sequence.schedule()}FFT.prototype.forward=function(e){var t=this.bufferSize,n=this.cosTable,r=this.sinTable,i=this.reverseTable,s=this.real,o=this.imag,u=this.spectrum,a=Math.floor(Math.log(t)/Math.LN2);if(Math.pow(2,a)!==t)throw"Invalid buffer size, must be a power of 2.";if(t!==e.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+t+" Buffer Size: "+e.length;var f=1,l,c,h,p,d,v,m,g,y;for(y=0;y<t;y++){s[y]=e[i[y]];o[y]=0}while(f<t){l=n[f];c=r[f];h=1;p=0;for(var b=0;b<f;b++){y=b;while(y<t){d=y+f;v=h*s[d]-p*o[d];m=h*o[d]+p*s[d];s[d]=s[y]-v;o[d]=o[y]-m;s[y]+=v;o[y]+=m;y+=f<<1}g=h;h=g*l-p*c;p=g*c+p*l}f<<=1}o[0]=s[t/2]};FFT.prototype.inverse=function(e,t){var n=this.bufferSize,r=this.cosTable,i=this.sinTable,s=this.reverseTable,o=this.spectrum;e=e||this.real;t=t||this.imag;var u=1,a,f,l,c,h,p,d,v,m,g=n,y=t[0];t[0]=0;e[g/2]=y;t[g/2]=0;for(m=1+g/2;m<g;m++){e[m]=e[g-m];t[m]=-t[g-m]}for(m=0;m<n;m++)t[m]*=-1;var b=new Float32Array(n),w=new Float32Array(n);for(m=0;m<e.length;m++){b[m]=e[s[m]];w[m]=t[s[m]]}e=b;t=w;while(u<n){a=r[u];f=i[u];l=1;c=0;for(var E=0;E<u;E++){m=E;while(m<n){h=m+u;p=l*e[h]-c*t[h];d=l*t[h]+c*e[h];e[h]=e[m]-p;t[h]=t[m]-d;e[m]+=p;t[m]+=d;m+=u<<1}v=l;l=v*a-c*f;c=v*f+c*a}u<<=1}var S=new Float32Array(n);for(m=0;m<n;m++)S[m]=e[m]/n;return S};var times=[1/8,.5/3,.1875,.25,1/3,.375,.5,2/3,.75,1,4/3,1.5,2];BpmDelay.prototype.setTempo=function(e){this.tempo=e;this.updateDelayTime()};BpmDelay.prototype.setDelayValue=function(e){var t=6;e=="32nd note"?t=0:e=="16th note triplet"?t=1:e=="dotted 32nd note"?t=2:e=="16th note"?t=3:e=="8th note triplet"?t=4:e=="dotted 16th note"?t=5:e=="8th note"?t=6:e=="quarter note triplet"?t=7:e=="dotted eighth note"?t=8:e=="quarter note"?t=9:alert("bad BPM index");this.setDelayIndex(t)};BpmDelay.prototype.setDelayIndex=function(e){this.noteDivision=times[e];this.updateDelayTime()};BpmDelay.prototype.updateDelayTime=function(){var e=.37299/44100+60*this.noteDivision/this.tempo;this.delay.delayTime.value=e};var threshold=-24,headroom=21;WaveShaper.prototype.setDrive=function(e){this.input.gain.value=e;var t=Math.pow(1/e,.6);this.output.gain.value=t};var kDefaultNumberOfResampleRanges=11;WaveTable.prototype.getWaveDataForPitch=function(e){var t=.5*this.sampleRate,n=this.getNumberOfPartialsForRange(0),r=t/n,i=e/r,s=i==0?0:Math.floor(Math.log(i)/Math.LN2);s<0&&(s=0);s>=this.numberOfResampleRanges&&(s=this.numberOfResampleRanges-1);return this.buffers[s]};WaveTable.prototype.getNumberOfPartialsForRange=function(e){var t=Math.pow(2,1+this.numberOfResampleRanges-e);this.getSampleRate()>48e3&&(t*=2);return t};WaveTable.prototype.getWaveTableSize=function(){return this.waveTableSize};WaveTable.prototype.getSampleRate=function(){return this.sampleRate};WaveTable.prototype.getRateScale=function(){return this.getWaveTableSize()/this.getSampleRate()};WaveTable.prototype.getNumberOfResampleRanges=function(){this.numberOfResampleRanges};WaveTable.prototype.getName=function(){return this.name};WaveTable.prototype.load=function(callback){var request=new XMLHttpRequest;request.open("GET",this.url,!0);var wave=this;request.onload=function(){var f=eval("("+request.responseText+")"),n=f.real.length;frequencyData={real:new Float32Array(n),imag:new Float32Array(n)};wave.frequencyData=frequencyData;for(var i=0;i<n;++i){frequencyData.real[i]=f.real[i];frequencyData.imag[i]=f.imag[i]}wave.createBuffers();callback&&callback(wave)};request.onerror=function(){alert("error loading: "+wave.url)};request.send()};WaveTable.prototype.print=function(){var e=this.frequencyData,t=document.getElementById("info"),n="";for(var r=0;r<2048;++r)n+="{"+e.real[r]+", "+e.imag[r]+"}, <br>";t.innerHTML=n};WaveTable.prototype.printBuffer=function(e){var t=document.getElementById("info"),n="";for(var r=0;r<4096;++r)n+=e[r]+"<br>";t.innerHTML=n};WaveTable.prototype.createBuffers=function(){this.buffers=new Array;var e=1;for(var t=0;t<this.numberOfResampleRanges;++t){var n=this.waveTableSize,r=new FFT(n,this.sampleRate),i=this.frequencyData,s=n;for(var o=0;o<n/2;++o){r.real[o]=s*i.real[o];r.imag[o]=s*i.imag[o]}var u=r.real,a=r.imag,f=n,l=f/2,c=this.getNumberOfPartialsForRange(t);for(var o=c+1;o<l;o++){u[o]=0;a[o]=0}c<l&&(a[0]=0);u[0]=0;if(t==0){var h=0;for(var o=1;o<l;++o){x=u[o];y=a[o];h+=x*x+y*y}h=Math.sqrt(h)/f;e=.5/h}var p=r.inverse(),d=this.context.createBuffer(1,p.length,this.sampleRate),v=d.getChannelData(0);for(var o=0;o<p.length;++o)v[o]=e*p[o];this.buffers[t]=d}};WaveTable.prototype.displayWaveData=function(){var e=this.data,t=e.length,n="";for(var r=0;r<t;++r)n+=e[r].toFixed(3)+"<br> ";var i=document.getElementById("info");i.innerHTML=n};var currentView=0,UNITS={hertz:0,cents:1,decibels:2,seconds:3,indexed:4,percent:5,bpm:6,generic:7};KnobView.prototype.attach=function(){var e=document.getElementById(this.name);this.canvas=e;var t=e.getContext("2d");this.ctx=t;this.width=e.width;this.height=e.height;var n=this;e.addEventListener("mousedown",function(e){var t=getElementCoordinates(n,e);currentView=n;n.isDragging=!0;n.startPosition=t;n.startPreValue=n.valueToPre(n.value);n.mouseDown(t)},!0);document.addEventListener("mousemove",function(e){if(currentView&&currentView==n){var t=getElementCoordinates(currentView.canvas,e);currentView.mouseMove(t)}},!0);document.addEventListener("mouseup",function(e){if(currentView&&currentView==n){n.isDragging=!1;var t=getElementCoordinates(currentView.canvas,e);currentView.mouseUp(t);currentView=0}},!0);this.draw()};KnobView.prototype.preToValue=function(e){if(this.useLogScale){var t=Math.log(this.minValue),n=Math.log(this.maxValue),r=t+e*(n-t);return Math.exp(r)}return this.minValue+e*(this.maxValue-this.minValue)};KnobView.prototype.valueToPre=function(e){if(this.useLogScale){var t=Math.log(this.minValue),n=Math.log(this.maxValue),r=Math.log(e);return(r-t)/(n-t)}return(e-this.minValue)/(this.maxValue-this.minValue)};KnobView.prototype.draw=function(){var e=this.ctx,t=this.width,n=this.height;e.fillStyle=this.backgroundColor;e.fillRect(0,0,t,n);e.fillStyle=this.knobColor;e.beginPath();var r=.7*n/2,i=10;e.arc(r+i,n/2,r,0,Math.PI*2,!0);e.fill();e.strokeStyle=this.knobOutlineColor;e.lineWidth=2;e.beginPath();e.arc(r+i,n/2,r,0,Math.PI*2,!0);e.stroke();e.strokeStyle=this.valueIndicatorColor;e.lineWidth=4;e.lineCap="round";e.beginPath();var s=1.75*Math.PI,o=.25*Math.PI,u=-0.5*Math.PI+s*(1-this.preValue)+o*this.preValue,a=.8*r*Math.cos(u),f=.8*r*Math.sin(u);e.moveTo(r+i,n/2);e.lineTo(a+r+i,-f+n/2);e.stroke();e.textAlign="left";e.fillStyle=this.textColor;e.lineWidth=1;e.font="12pt Helvetica";var l=n-6,c=2*r+i+12;e.fillText(this.name,c,l);var h=t-30,p=this.value.toFixed(this.precision);switch(this.units){case UNITS.hertz:p+=" Hz";break;case UNITS.cents:p+=" cents";break;case UNITS.decibels:p+=" dB";break;case UNITS.seconds:p+=" sec";break;case UNITS.percent:p+="%";break;case UNITS.bpm:p+=" bpm";break;case UNITS.generic:}e.textAlign="right";e.fillText(p,h,l)};KnobView.prototype.mouseDown=function(e){};KnobView.prototype.mouseMove=function(e){this.isDragging&&this.mouseDrag(e)};KnobView.prototype.mouseDrag=function(e){var t=e.y-this.startPosition.y,n=200,r=this.startPreValue+ -t/n;r<0&&(r=0);r>1&&(r=1);this.preValue=r;this.value=this.preToValue(r);this.units==UNITS.indexed&&(this.value=Math.floor(this.value));this.onchange(this.value);this.draw()};KnobView.prototype.mouseUp=function(e){};window.onload=init;var arp=!0,context,staticAudioRouting,loader,startTime,cutoff=.2,resonance=12,envAmount=.4,width=.6,detune1=4.5,detune2=-2.5,octave=0,defaultWaveTableName="Celeste",waveTable,waveTable2,volume=1,filterAttack=.056,filterDecay=.991,ampAttack=.056,ampDecay=.1,playDoubleOctave=!1,grungeDrive=1,views,sequence,sequenceView,isShiftDown=!1,isAltDown=!1,monophonicNote,playMonophonic=!0;window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}());WaveTableLoader.prototype.load=function(e){var t=this;t.finishedCallback=e;t.loadedCount=0;t.waveList=new Array;for(var n=0;n<t.waveNames.length;++n){var r=t.waveNames[n];t.waveList[n]=new WaveTable(r,context);t.waveList[n].load(function(e){t.loadedCount++;t.loadedCount==t.waveList.length&&t.finishedCallback()})}};WaveTableLoader.prototype.makeWavePopup=function(e){var t=document.getElementById(e),n=this.waveNames.length;for(var r=0;r<n;r++){var i=document.createElement("option");i.innerHTML=this.waveNames[r];this.waveNames[r]==defaultWaveTableName&&(i.selected="selected");t.appendChild(i)}};WaveTableLoader.prototype.getTable=function(e){for(var t=0;t<this.waveNames.length;++t)if(e==this.waveNames[t])return this.waveList[t]};window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}());SequenceView.prototype.draw=function(){var e=this.ctx,t=this.width,n=this.height;e.fillStyle=this.backgroundColor;e.fillRect(0,0,t,n);var r=this.numberOfNotes;e.strokeStyle=this.gridColor;e.lineWidth=1;for(var i=0;i<r;++i){var s=i*t/r;e.beginPath();e.moveTo(s,0);e.lineTo(s,n);e.stroke()}var o=t/r,u=this.numSemitones,a=n/u;for(var i=0;i<r;++i)if(sequence.rhythm[i]!=-1){var s=i*t/r,f=-a+n-sequence.rhythm[i]*a;e.fillStyle=this.noteColor;e.fillRect(s,f,o,a)}};SequenceView.prototype.drawPlayhead=function(){function l(){f.drawPlayhead()}var e=this.ctx,t=this.width,n=this.height,r=this.numberOfNotes,i=t/r,s=this.numSemitones,o=n/s;if(this.sequence.lastRhythmIndex!=this.lastDrawnRhythmIndex){var u=this.lastDrawnRhythmIndex*t/r,a=0;e.fillStyle=this.backgroundColor;e.fillRect(u,a,i,o);var u=this.sequence.lastRhythmIndex*t/r,a=0;e.fillStyle=this.playheadColor;e.fillRect(u,a,i,o);this.lastDrawnRhythmIndex=this.sequence.lastRhythmIndex}var f=this;window.requestAnimationFrame(l)};SequenceView.prototype.mouseDown=function(e){var t=this.width,n=this.height,r=this.numberOfNotes,i=t/r,s=this.numSemitones,o=n/s,u=Math.floor(e.x/i),a=Math.floor((n-e.y)/o);if(u>=0&&u<r&&a>=0){isAltDown?sequence.rhythm[u]=-1:sequence.rhythm[u]=a;this.draw()}};SequenceView.prototype.mouseMove=function(e){this.isDragging&&this.mouseDrag(e)};SequenceView.prototype.mouseDrag=function(e){};SequenceView.prototype.mouseUp=function(e){};var tempo=85;Sequence.prototype.advanceNote=function(){var e=60/tempo;this.noteTime+=.25*e;this.lastRhythmIndex=this.rhythmIndex;this.rhythmIndex++;if(this.rhythmIndex==this.loopLength){this.rhythmIndex=0;this.loopNumber++}};Sequence.prototype.schedule=function(){var e=context.currentTime;e-=startTime;while(this.noteTime<e+.04){var t=this.noteTime+startTime;if(this.rhythm[this.rhythmIndex]!=-1){var n=this.rhythm[this.rhythmIndex];if(arp){var r=[0,3,7,10],i=Math.floor(n/4),s=n%4;n=r[s]+12*i}if(playMonophonic)monophonicNote.play(waveTable,waveTable2,n,octave,t);else{var o=new Note(staticAudioRouting,!1);o.play(waveTable,waveTable2,n,octave,t);if(playDoubleOctave){var u=new Note(staticAudioRouting,!1);u.play(waveTable,waveTable2,n+12,octave,t)}}}this.advanceNote()}setTimeout("ddd()",0)};Note.prototype.setFilterValues=function(){var e=this.time,t=this.filter,n=this.pitchFrequency;t.frequency.cancelScheduledValues(0);t.type=0;t.Q.value=resonance;var r=.5*context.sampleRate,i=9600*cutoff,s=Math.pow(2,i/1200),o=s*n;o>r&&(o=r);var u=7200*envAmount,a=Math.pow(2,u/1200),f=o*a;f>r&&(f=r);if(!this.isMonophonic){t.frequency.value=o;t.frequency.setValueAtTime(o,e)}t.frequency.setTargetValueAtTime(f,e,filterAttack);t.frequency.setTargetValueAtTime(o,e+filterAttack,filterDecay)};var firstTime=!0;Note.prototype.play=function(e,t,n,r,i){this.time=i;if(e!=this.wave||t!=this.wave2||!this.isMonophonic){this.wave=e;this.wave2=t;firstTime=!0}var s=this.osc1,o=this.osc2,u=this.osc1Octave,a=this.osc2Octave,f=this.panner1,l=this.panner2,c=this.ampEnvelope,h=this.filter,p=this.noteVolume,d=20*Math.pow(2,n/12);this.pitchFrequency=d;var v=d*e.getRateScale(),m=v*Math.pow(2,-detune1/1200),g=e.getWaveDataForPitch(m);firstTime&&(s.buffer=g);s.playbackRate.value=m;var y=v*Math.pow(2,r-detune2/1200),b=t.getWaveDataForPitch(y);firstTime&&(u.buffer=b);u.playbackRate.value=y;firstTime&&(o.buffer=g);o.playbackRate.value=v*Math.pow(2,+detune1/1200);firstTime&&(a.buffer=b);a.playbackRate.value=v*Math.pow(2,r+detune2/1200);var w=Math.sin(.5*Math.PI*width),E=-Math.cos(.5*Math.PI*width);f.panningModel=webkitAudioPannerNode.EQUALPOWER;f.setPosition(-w,0,E);l.panningModel=webkitAudioPannerNode.EQUALPOWER;l.setPosition(w,0,E);c.gain.cancelScheduledValues(0);this.isMonophonic||c.gain.setValueAtTime(0,i);var S=i+ampAttack;c.gain.setTargetValueAtTime(1,i,ampAttack);c.gain.setTargetValueAtTime(0,S,ampDecay);this.setFilterValues();p.gain.value=.1*volume*volume;if(!this.isMonophonic){var x=8*ampDecay;x<.1&&(x=.1);x>4&&(x=4);var T=S+x;s.noteOn(i);o.noteOn(i);s.noteOff(T);o.noteOff(T);u.noteOn(i);a.noteOn(i);u.noteOff(T);a.noteOff(T)}else firstTime=!1};StaticAudioRouting.prototype.setDelayDryWet=function(e){var t=.5*(1+Math.cos(e*Math.PI)),n=.5*(1+Math.cos((1-e)*Math.PI));this.delayDry.gain.value=t;this.delayWet.gain.value=n};StaticAudioRouting.prototype.setReverbDryWet=function(e){var t=.5*(1+Math.cos(e*Math.PI)),n=.5*(1+Math.cos((1-e)*Math.PI));this.convolverDry.gain.value=t;this.convolverWet.gain.value=n};StaticAudioRouting.prototype.setDelayFeedback=function(e){this.delayFeedback.gain.value=e};StaticAudioRouting.prototype.setDelayGrunge=function(e){this.delayWaveShaper.setDrive(Math.pow(10,.05*e))};StaticAudioRouting.prototype.setMainGrunge=function(e){this.grungeWaveShaper.setDrive(Math.pow(10,.05*e))};(function(e){String.prototype.trim===e&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});Array.prototype.reduce===e&&(Array.prototype.reduce=function(t){if(this===void 0||this===null)throw new TypeError;var n=Object(this),r=n.length>>>0,i=0,s;if(typeof t!="function")throw new TypeError;if(r==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)s=arguments[1];else do{if(i in n){s=n[i++];break}if(++i>=r)throw new TypeError}while(!0);while(i<r){i in n&&(s=t.call(e,s,n[i],i,n));i++}return s})})();var Zepto=function(){function C(e){return E.call(e)=="[object Function]"}function k(e){return e instanceof Object}function L(t){var n,r;if(E.call(t)!=="[object Object]")return!1;r=C(t.constructor)&&t.constructor.prototype;if(!r||!hasOwnProperty.call(r,"isPrototypeOf"))return!1;for(n in t);return n===e||hasOwnProperty.call(t,n)}function A(e){return e instanceof Array}function O(e){return typeof e.length=="number"}function M(t){return t.filter(function(t){return t!==e&&t!==null})}function _(e){return e.length>0?[].concat.apply([],e):e}function D(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function P(e){return e in a?a[e]:a[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function H(e,t){return typeof t=="number"&&!l[D(e)]?t+"px":t}function B(e){var t,n;if(!u[e]){t=o.createElement(e);o.body.appendChild(t);n=f(t,"").getPropertyValue("display");t.parentNode.removeChild(t);n=="none"&&(n="block");u[e]=n}return u[e]}function j(t,r){return r===e?n(t):n(t).filter(r)}function F(e,t,n,r){return C(t)?t.call(e,n,r):t}function I(e,t,r){var i=e%2?t:t.parentNode;i?i.insertBefore(r,e?e==1?i.firstChild:e==2?t:null:t.nextSibling):n(r).remove()}function q(e,t){t(e);for(var n in e.childNodes)q(e.childNodes[n],t)}var e,t,n,r,i=[],s=i.slice,o=window.document,u={},a={},f=o.defaultView.getComputedStyle,l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},c=/^\s*<(\w+|!)[^>]*>/,h=[1,3,8,9,11],p=["after","prepend","before","append"],d=o.createElement("table"),v=o.createElement("tr"),m={tr:o.createElement("tbody"),tbody:d,thead:d,tfoot:d,td:v,th:v,"*":o.createElement("div")},g=/complete|loaded|interactive/,y=/^\.([\w-]+)$/,b=/^#([\w-]+)$/,w=/^[\w-]+$/,E={}.toString,S={},x,T,N=o.createElement("div");S.matches=function(e,t){if(!e||e.nodeType!==1)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,s=!i;s&&(i=N).appendChild(e);r=~S.qsa(i,t).indexOf(e);s&&N.removeChild(e);return r};x=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})};T=function(e){return e.filter(function(t,n){return e.indexOf(t)==n})};S.fragment=function(t,r){r===e&&(r=c.test(t)&&RegExp.$1);r in m||(r="*");var i=m[r];i.innerHTML=""+t;return n.each(s.call(i.childNodes),function(){i.removeChild(this)})};S.Z=function(e,t){e=e||[];e.__proto__=arguments.callee.prototype;e.selector=t||"";return e};S.isZ=function(e){return e instanceof S.Z};S.init=function(t,r){if(!t)return S.Z();if(C(t))return n(o).ready(t);if(S.isZ(t))return t;var i;if(A(t))i=M(t);else if(L(t))i=[n.extend({},t)],t=null;else if(h.indexOf(t.nodeType)>=0||t===window)i=[t],t=null;else if(c.test(t))i=S.fragment(t.trim(),RegExp.$1),t=null;else{if(r!==e)return n(r).find(t);i=S.qsa(o,t)}return S.Z(i,t)};n=function(e,t){return S.init(e,t)};n.extend=function(n){s.call(arguments,1).forEach(function(r){for(t in r)r[t]!==e&&(n[t]=r[t])});return n};S.qsa=function(e,t){var n;return e===o&&b.test(t)?(n=e.getElementById(RegExp.$1))?[n]:i:e.nodeType!==1&&e.nodeType!==9?i:s.call(y.test(t)?e.getElementsByClassName(RegExp.$1):w.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t))};n.isFunction=C;n.isObject=k;n.isArray=A;n.isPlainObject=L;n.inArray=function(e,t,n){return i.indexOf.call(t,e,n)};n.trim=function(e){return e.trim()};n.uuid=0;n.map=function(e,t){var n,r=[],i,s;if(O(e))for(i=0;i<e.length;i++){n=t(e[i],i);n!=null&&r.push(n)}else for(s in e){n=t(e[s],s);n!=null&&r.push(n)}return _(r)};n.each=function(e,t){var n,r;if(O(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e};n.fn={forEach:i.forEach,reduce:i.reduce,push:i.push,indexOf:i.indexOf,concat:i.concat,map:function(e){return n.map(this,function(t,n){return e.call(t,n,t)})},slice:function(){return n(s.apply(this,arguments))},ready:function(e){g.test(o.readyState)?e(n):o.addEventListener("DOMContentLoaded",function(){e(n)},!1);return this},get:function(t){return t===e?s.call(this):this[t]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(e){this.forEach
(function(t,n){e.call(t,n,t)});return this},filter:function(e){return n([].filter.call(this,function(t){return S.matches(t,e)}))},add:function(e,t){return n(T(this.concat(n(e,t))))},is:function(e){return this.length>0&&S.matches(this[0],e)},not:function(t){var r=[];if(C(t)&&t.call!==e)this.each(function(e){t.call(this,e)||r.push(this)});else{var i=typeof t=="string"?this.filter(t):O(t)&&C(t.item)?s.call(t):n(t);this.forEach(function(e){i.indexOf(e)<0&&r.push(e)})}return n(r)},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!k(e)?e:n(e)},last:function(){var e=this[this.length-1];return e&&!k(e)?e:n(e)},find:function(e){var t;this.length==1?t=S.qsa(this[0],e):t=this.map(function(){return S.qsa(this,e)});return n(t)},closest:function(e,t){var r=this[0];while(r&&!S.matches(r,e))r=r!==t&&r!==o&&r.parentNode;return n(r)},parents:function(e){var t=[],r=this;while(r.length>0)r=n.map(r,function(e){if((e=e.parentNode)&&e!==o&&t.indexOf(e)<0){t.push(e);return e}});return j(t,e)},parent:function(e){return j(T(this.pluck("parentNode")),e)},children:function(e){return j(this.map(function(){return s.call(this.children)}),e)},siblings:function(e){return j(this.map(function(e,t){return s.call(t.parentNode.children).filter(function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return this.map(function(){return this[e]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null);f(this,"").getPropertyValue("display")=="none"&&(this.style.display=B(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){return this.each(function(){n(this).wrapAll(n(e)[0].cloneNode(!1))})},wrapAll:function(e){if(this[0]){n(this[0]).before(e=n(e));e.append(this)}return this},unwrap:function(){this.parent().each(function(){n(this).replaceWith(n(this).children())});return this},clone:function(){return n(this.map(function(){return this.cloneNode(!0)}))},hide:function(){return this.css("display","none")},toggle:function(t){return(t===e?this.css("display")=="none":t)?this.show():this.hide()},prev:function(){return n(this.pluck("previousElementSibling"))},next:function(){return n(this.pluck("nextElementSibling"))},html:function(t){return t===e?this.length>0?this[0].innerHTML:null:this.each(function(e){var r=this.innerHTML;n(this).empty().append(F(this,t,e,r))})},text:function(t){return t===e?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t})},attr:function(n,r){var i;return typeof n=="string"&&r===e?this.length==0||this[0].nodeType!==1?e:n=="value"&&this[0].nodeName=="INPUT"?this.val():!(i=this[0].getAttribute(n))&&n in this[0]?this[0][n]:i:this.each(function(e){if(this.nodeType!==1)return;if(k(n))for(t in n)this.setAttribute(t,n[t]);else this.setAttribute(n,F(this,r,e,this.getAttribute(n)))})},removeAttr:function(e){return this.each(function(){this.nodeType===1&&this.removeAttribute(e)})},prop:function(t,n){return n===e?this[0]?this[0][t]:e:this.each(function(e){this[t]=F(this,n,e,this[t])})},data:function(t,n){var r=this.attr("data-"+D(t),n);return r!==null?r:e},val:function(t){return t===e?this.length>0?this[0].value:e:this.each(function(e){this.value=F(this,t,e,this.value)})},offset:function(){if(this.length==0)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:e.width,height:e.height}},css:function(n,r){if(r===e&&typeof n=="string")return this.length==0?e:this[0].style[x(n)]||f(this[0],"").getPropertyValue(n);var i="";for(t in n)typeof n[t]=="string"&&n[t]==""?this.each(function(){this.style.removeProperty(D(t))}):i+=D(t)+":"+H(t,n[t])+";";typeof n=="string"&&(r==""?this.each(function(){this.style.removeProperty(D(n))}):i=D(n)+":"+H(n,r));return this.each(function(){this.style.cssText+=";"+i})},index:function(e){return e?this.indexOf(n(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return this.length<1?!1:P(e).test(this[0].className)},addClass:function(e){return this.each(function(t){r=[];var i=this.className,s=F(this,e,t,i);s.split(/\s+/g).forEach(function(e){n(this).hasClass(e)||r.push(e)},this);r.length&&(this.className+=(i?" ":"")+r.join(" "))})},removeClass:function(t){return this.each(function(n){if(t===e)return this.className="";r=this.className;F(this,t,n,r).split(/\s+/g).forEach(function(e){r=r.replace(P(e)," ")});this.className=r.trim()})},toggleClass:function(t,r){return this.each(function(i){var s=F(this,t,i,this.className);(r===e?!n(this).hasClass(s):r)?n(this).addClass(s):n(this).removeClass(s)})}};["width","height"].forEach(function(t){n.fn[t]=function(r){var i,s=t.replace(/./,function(e){return e[0].toUpperCase()});return r===e?this[0]==window?window["inner"+s]:this[0]==o?o.documentElement["offset"+s]:(i=this.offset())&&i[t]:this.each(function(e){var i=n(this);i.css(t,F(this,r,e,i[t]()))})}});p.forEach(function(e,t){n.fn[e]=function(){var e=n.map(arguments,function(e){return k(e)?e:S.fragment(e)});if(e.length<1)return this;var r=this.length,i=r>1,s=t<2;return this.each(function(n,o){for(var u=0;u<e.length;u++){var a=e[s?e.length-u-1:u];q(a,function(e){e.nodeName!=null&&e.nodeName.toUpperCase()==="SCRIPT"&&(!e.type||e.type==="text/javascript")&&window.eval.call(window,e.innerHTML)});i&&n<r-1&&(a=a.cloneNode(!0));I(t,o,a)}})};n.fn[t%2?e+"To":"insert"+(t?"Before":"After")]=function(t){n(t)[e](this);return this}});S.Z.prototype=n.fn;S.camelize=x;S.uniq=T;n.zepto=S;return n}();window.Zepto=Zepto;"$"in window||(window.$=Zepto);(function(e){function s(e){return e._zid||(e._zid=r++)}function o(e,t,r,i){t=u(t);if(t.ns)var o=a(t.ns);return(n[s(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||o.test(e.ns))&&(!r||s(e.fn)===s(r))&&(!i||e.sel==i)})}function u(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function a(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function f(t,n,r){e.isObject(t)?e.each(t,r):t.split(/\s/).forEach(function(e){r(e,n)})}function l(t,r,i,o,a,l){l=!!l;var c=s(t),h=n[c]||(n[c]=[]);f(r,i,function(n,r){var i=a&&a(r,n),s=i||r,f=function(e){var n=s.apply(t,[e].concat(e.data));n===!1&&e.preventDefault();return n},c=e.extend(u(n),{fn:r,proxy:f,sel:o,del:i,i:h.length});h.push(c);t.addEventListener(c.e,f,l)})}function c(e,t,r,i){var u=s(e);f(t||"",r,function(t,r){o(e,t,r,i).forEach(function(t){delete n[u][t.i];e.removeEventListener(t.e,t.proxy,!1)})})}function v(t){var n=e.extend({originalEvent:t},t);e.each(d,function(e,r){n[e]=function(){this[r]=h;return t[e].apply(t,arguments)};n[r]=p});return n}function m(e){if(!("defaultPrevented"in e)){e.defaultPrevented=!1;var t=e.preventDefault;e.preventDefault=function(){this.defaultPrevented=!0;t.call(this)}}}var t=e.zepto.qsa,n={},r=1,i={};i.click=i.mousedown=i.mouseup=i.mousemove="MouseEvents";e.event={add:l,remove:c};e.proxy=function(t,n){if(e.isFunction(t)){var r=function(){return t.apply(n,arguments)};r._zid=s(t);return r}if(typeof n=="string")return e.proxy(t[n],t);throw new TypeError("expected function")};e.fn.bind=function(e,t){return this.each(function(){l(this,e,t)})};e.fn.unbind=function(e,t){return this.each(function(){c(this,e,t)})};e.fn.one=function(e,t){return this.each(function(n,r){l(this,e,t,null,function(e,t){return function(){var n=e.apply(r,arguments);c(r,t,e);return n}})})};var h=function(){return!0},p=function(){return!1},d={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(t,n,r){var i=!1;if(n=="blur"||n=="focus")e.iswebkit?n=n=="blur"?"focusout":n=="focus"?"focusin":n:i=!0;return this.each(function(s,o){l(o,n,r,t,function(n){return function(r){var i,s=e(r.target).closest(t,o).get(0);if(s){i=e.extend(v(r),{currentTarget:s,liveFired:o});return n.apply(s,[i].concat([].slice.call(arguments,1)))}}},i)})};e.fn.undelegate=function(e,t,n){return this.each(function(){c(this,t,n,e)})};e.fn.live=function(t,n){e(document.body).delegate(this.selector,t,n);return this};e.fn.die=function(t,n){e(document.body).undelegate(this.selector,t,n);return this};e.fn.on=function(t,n,r){return n==undefined||e.isFunction(n)?this.bind(t,n):this.delegate(n,t,r)};e.fn.off=function(t,n,r){return n==undefined||e.isFunction(n)?this.unbind(t,n):this.undelegate(n,t,r)};e.fn.trigger=function(t,n){typeof t=="string"&&(t=e.Event(t));m(t);t.data=n;return this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(t)})};e.fn.triggerHandler=function(t,n){var r,i;this.each(function(s,u){r=v(typeof t=="string"?e.Event(t):t);r.data=n;r.target=u;e.each(o(u,t.type||t),function(e,t){i=t.proxy(r);if(r.isImmediatePropagationStopped())return!1})});return i};"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}});["focus","blur"].forEach(function(t){e.fn[t]=function(e){if(e)this.bind(t,e);else if(this.length)try{this.get(0)[t]()}catch(n){}return this}});e.Event=function(e,t){var n=document.createEvent(i[e]||"Events"),r=!0;if(t)for(var s in t)s=="bubbles"?r=!!t[s]:n[s]=t[s];n.initEvent(e,r,!0,null,null,null,null,null,null,null,null,null,null,null,null);return n}})(Zepto);(function(e){function t(e){var t=this.os={},n=this.browser={},r=e.match(/WebKit\/([\d.]+)/),i=e.match(/(Android)\s+([\d.]+)/),s=e.match(/(iPad).*OS\s([\d_]+)/),o=!s&&e.match(/(iPhone\sOS)\s([\d_]+)/),u=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),a=u&&e.match(/TouchPad/),f=e.match(/Kindle\/([\d.]+)/),l=e.match(/Silk\/([\d._]+)/),c=e.match(/(BlackBerry).*Version\/([\d.]+)/);if(n.webkit=!!r)n.version=r[1];i&&(t.android=!0,t.version=i[2]);o&&(t.ios=t.iphone=!0,t.version=o[2].replace(/_/g,"."));s&&(t.ios=t.ipad=!0,t.version=s[2].replace(/_/g,"."));u&&(t.webos=!0,t.version=u[2]);a&&(t.touchpad=!0);c&&(t.blackberry=!0,t.version=c[2]);f&&(t.kindle=!0,t.version=f[1]);l&&(n.silk=!0,n.version=l[1]);!l&&t.android&&e.match(/Kindle Fire/)&&(n.silk=!0)}t.call(e,navigator.userAgent);e.__detect=t})(Zepto);(function(e,t){function c(e){return e.toLowerCase()}function h(e){return r?r+e:c(e)}var n="",r,i,s,o={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},u=window.document,a=u.createElement("div"),f=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,l={};e.each(o,function(e,i){if(a.style[e+"TransitionProperty"]!==t){n="-"+c(e)+"-";r=i;return!1}});l[n+"transition-property"]=l[n+"transition-duration"]=l[n+"transition-timing-function"]=l[n+"animation-name"]=l[n+"animation-duration"]="";e.fx={off:r===t&&a.style.transitionProperty===t,cssPrefix:n,transitionEnd:h("TransitionEnd"),animationEnd:h("AnimationEnd")};e.fn.animate=function(t,n,r,i){e.isObject(n)&&(r=n.easing,i=n.complete,n=n.duration);n&&(n/=1e3);return this.anim(t,n,r,i)};e.fn.anim=function(r,i,s,o){var u,a={},c,h=this,p,d=e.fx.transitionEnd;i===t&&(i=.4);e.fx.off&&(i=0);if(typeof r=="string"){a[n+"animation-name"]=r;a[n+"animation-duration"]=i+"s";d=e.fx.animationEnd}else{for(c in r)if(f.test(c)){u||(u=[]);u.push(c+"("+r[c]+")")}else a[c]=r[c];u&&(a[n+"transform"]=u.join(" "));if(!e.fx.off&&typeof r=="object"){a[n+"transition-property"]=Object.keys(r).join(", ");a[n+"transition-duration"]=i+"s";a[n+"transition-timing-function"]=s||"linear"}}p=function(t){if(typeof t!="undefined"){if(t.target!==t.currentTarget)return;e(t.target).unbind(d,arguments.callee)}e(this).css(l);o&&o.call(this)};i>0&&this.bind(d,p);setTimeout(function(){h.css(a);i<=0&&setTimeout(function(){h.each(function(){p.call(this)})},0)},0);return this};a=null})(Zepto);(function($){function triggerAndReturn(e,t,n){var r=$.Event(t);$(e).trigger(r,n);return!r.defaultPrevented}function triggerGlobal(e,t,n,r){if(e.global)return triggerAndReturn(t||document,n,r)}function ajaxStart(e){e.global&&$.active++===0&&triggerGlobal(e,null,"ajaxStart")}function ajaxStop(e){e.global&&!--$.active&&triggerGlobal(e,null,"ajaxStop")}function ajaxBeforeSend(e,t){var n=t.context;if(t.beforeSend.call(n,e,t)===!1||triggerGlobal(t,n,"ajaxBeforeSend",[e,t])===!1)return!1;triggerGlobal(t,n,"ajaxSend",[e,t])}function ajaxSuccess(e,t,n){var r=n.context,i="success";n.success.call(r,e,i,t);triggerGlobal(n,r,"ajaxSuccess",[t,n,e]);ajaxComplete(i,t,n)}function ajaxError(e,t,n,r){var i=r.context;r.error.call(i,n,t,e);triggerGlobal(r,i,"ajaxError",[n,r,e]);ajaxComplete(t,n,r)}function ajaxComplete(e,t,n){var r=n.context;n.complete.call(r,t,e);triggerGlobal(n,r,"ajaxComplete",[t,n]);ajaxStop(n)}function empty(){}function mimeToDataType(e){return e&&(e==htmlType?"html":e==jsonType?"json":scriptTypeRE.test(e)?"script":xmlTypeRE.test(e)&&"xml")||"text"}function appendQuery(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){isObject(e.data)&&(e.data=$.param(e.data));e.data&&(!e.type||e.type.toUpperCase()=="GET")&&(e.url=appendQuery(e.url,e.data))}function serialize(e,t,n,r){var i=$.isArray(t);$.each(t,function(t,s){r&&(t=n?r:r+"["+(i?"":t)+"]");!r&&i?e.add(s.name,s.value):(n?$.isArray(s):isObject(s))?serialize(e,s,n,t):e.add(t,s)})}var jsonpID=0,isObject=$.isObject,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0;$.ajaxJSONP=function(e){var t="jsonp"+ ++jsonpID,n=document.createElement("script"),r=function(){$(n).remove();t in window&&(window[t]=empty);ajaxComplete("abort",i,e)},i={abort:r},s;e.error&&(n.onerror=function(){i.abort();e.error()});window[t]=function(r){clearTimeout(s);$(n).remove();delete window[t];ajaxSuccess(r,i,e)};serializeData(e);n.src=e.url.replace(/=\?/,"="+t);$("head").append(n);e.timeout>0&&(s=setTimeout(function(){i.abort();ajaxComplete("timeout",i,e)},e.timeout));return i};$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0};$.ajax=function(options){var settings=$.extend({},options||{});for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings);settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host);var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder){hasPlaceholder||(settings.url=appendQuery(settings.url,"callback=?"));return $.ajaxJSONP(settings)}settings.url||(settings.url=window.location.toString());serializeData(settings);var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=$.ajaxSettings.xhr(),abortTimeout;settings.crossDomain||(baseHeaders["X-Requested-With"]="XMLHttpRequest");if(mime){baseHeaders.Accept=mime;mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]);xhr.overrideMimeType&&xhr.overrideMimeType(mime)}if(settings.contentType||settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=$.extend(baseHeaders,settings.headers||{});xhr.onreadystatechange=function(){if(xhr.readyState==4){clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type"));result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:JSON.parse(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings):ajaxSuccess(result,xhr,settings)}else ajaxError(null,"error",xhr,settings)}};var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);if(ajaxBeforeSend(xhr,settings)===!1){xhr.abort();return!1}settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty;xhr.abort();ajaxError(null,"timeout",xhr,settings)},settings.timeout));xhr.send(settings.data?settings.data:null);return xhr};$.get=function(e,t){return $.ajax({url:e,success:t})};$.post=function(e,t,n,r){$.isFunction(t)&&(r=r||n,n=t,t=null);return $.ajax({type:"POST",url:e,data:t,success:n,dataType:r})};$.getJSON=function(e,t){return $.ajax({url:e,success:t,dataType:"json"})};$.fn.load=function(e,t){if(!this.length)return this;var n=this,r=e.split(/\s/),i;r.length>1&&(e=r[0],i=r[1]);$.get(e,function(e){n.html(i?$(document.createElement("div")).html(e.replace(rscript,"")).find(i).html():e);t&&t.call(n)});return this};var escape=encodeURIComponent;$.param=function(e,t){var n=[];n.add=function(e,t){this.push(escape(e)+"="+escape(t))};serialize(n,e,t);return n.join("&").replace("%20","+")}})(Zepto);(function(e){e.fn.serializeArray=function(){var t=[],n;e(Array.prototype.slice.call(this.get(0).elements)).each(function(){n=e(this);var r=n.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&r!="submit"&&r!="reset"&&r!="button"&&(r!="radio"&&r!="checkbox"||this.checked)&&t.push({name:n.attr("name"),value:n.val()})});return t};e.fn.serialize=function(){var e=[];this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))});return e.join("&")};e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n);n.defaultPrevented||this.get(0).submit()}return this}})(Zepto);(function(e){function r(e){return"tagName"in e?e:e.parentNode}function i(e,t,n,r){var i=Math.abs(e-t),s=Math.abs(n-r);return i>=s?e-t>0?"Left":"Right":n-r>0?"Up":"Down"}function u(){o=null;if(t.last){t.el.trigger("longTap");t={}}}function a(){o&&clearTimeout(o);o=null}var t={},n,s=750,o;e(document).ready(function(){var f,l;e(document.body).bind("touchstart",function(i){f=Date.now();l=f-(t.last||f);t.el=e(r(i.touches[0].target));n&&clearTimeout(n);t.x1=i.touches[0].pageX;t.y1=i.touches[0].pageY;l>0&&l<=250&&(t.isDoubleTap=!0);t.last=f;o=setTimeout(u,s)}).bind("touchmove",function(e){a();t.x2=e.touches[0].pageX;t.y2=e.touches[0].pageY}).bind("touchend",function(e){a();if(t.isDoubleTap){t.el.trigger("doubleTap");t={}}else if(t.x2&&Math.abs(t.x1-t.x2)>30||t.y2&&Math.abs(t.y1-t.y2)>30){t.el.trigger("swipe")&&t.el.trigger("swipe"+i(t.x1,t.x2,t.y1,t.y2));t={}}else if("last"in t){t.el.trigger("tap");n=setTimeout(function(){n=null;t.el.trigger("singleTap");t={}},250)}}).bind("touchcancel",function(){n&&clearTimeout(n);o&&clearTimeout(o);o=n=null;t={}})});["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}})})(Zepto);(function(e){e.os.touch=typeof window.ontouchstart!="undefined";var t=2500,n=function(e){var t,n;if(typeof e[0]=="function")t=e[0];else{n=e[0];t=e[1]}return[n,t]};if(e.os.touch){var r=[],i={},s=e(document),o=!1,u={},a=function(e){e.stopPropagation();i.x=e.touches[0].pageX;i.y=e.touches[0].pageY;o=!1},f=function(e){if(Math.abs(e.touches[0].pageX-i.x)>10||Math.abs(e.touches[0].pageX-i.y)>10)o=!0},l=function(){r.splice(0,2)},c=function(e){var t,n;for(t=0,n=r.length;t<n;t+=2)if(Math.abs(e.pageX-r[t])<25&&Math.abs(e.pageY-r[t+1])<25){e.stopPropagation();e.preventDefault()}};s.on("click",c);s.on("touchmove",f);e.fn.onpress=function(){var e=n(arguments),s=function(n){n.stopPropagation();if(!o){e[1].call(this,n);r.push(i.x,i.y);window.setTimeout(l,t)}};u[e[1]]=s;if(e[0]){this.on("touchstart.onpress",e[0],a);this.on("touchend.onpress",e[0],s);this.on("press",e[0],e[1])}else{this.on("touchstart.onpress",a);this.on("touchend.onpress",s);this.on("press",e[1])}};e.fn.offpress=function(){var e=n(arguments);if(e[1]){if(e[0]){this.off(".onpress",e[0],u[e[1]]);this.off("press",e[0],e[1])}else{this.off(".onpress",u[e[1]]);this.off("press",e[1])}delete u[e[1]]}else if(e[0]){this.off(".onpress",e[0]);this.off("press",e[0])}else{this.off(".onpress");this.off("press")}}}else{e.fn.onpress=function(){var e=n(arguments);if(e[0]){this.on("click.onpress",e[0],e[1]);this.on("press.onpress",e[0],e[1])}else{this.on("click.onpress",e[1]);this.on("press.onpress",e[1])}};e.fn.offpress=function(){var e=n(arguments);e[0]?this.off(".onpress",e[0],e[1]):this.off(".onpress",e[1])}}})(Zepto);(function(e){function t(){var t="";for(var n=0;n<3;n++)t+=l.eventLog[n]+" | ";var r="<pre> \n		last 3 events: "+t+"<br /> \n		start: {x:"+l.start.x+", y:"+l.start.y+",time: "+l.start.time+"}<br /> \n			delta: {<br /> \n			prevPos: {"+l.delta.prevPos.x+", "+l.delta.prevPos.y+"}<br /> \n			dist: {"+l.delta.dist.x+", "+l.delta.dist.y+"}<br /> \n			dir: {"+l.delta.dir.x+", "+l.delta.dir.y+"}<br /> \n			}<br /> \n		end: {<br /> \n			speed: {"+l.end.speed.x+", "+l.end.speed.y+"}<br /> \n			flick: {"+l.end.flick.x+", "+l.end.flick.y+"}<br /> \n			duration: "+l.end.duration+"<br /> \n		} \n		</pre>";e("#flickableDebugger").html(r)}function n(e){if(m){console.log(e);l.eventLog.splice(0,0,e);t()}}function r(){if(!e("#flickableDebugger").length){m=!0;l=c;l.eventLog=[];var t='<div id="flickableDebugger" style="position: fixed; bottom: 0; margin: 0 auto; padding: 10px; width: 100%; background: #000; color: #fff; font-family: courier, sans-serif;">Debugger</div>';e("body").append(t)}}function i(e){var t=document.createElement("div"),n="Khtml Ms O Moz Webkit".split(" "),r=n.length;return function(e){if(e in t.style)return!0;e=e.replace(/^[a-z]/,function(e){return e.toUpperCase()});while(r--)if(n[r]+e in t.style)return!0;return!1}}function s(e,t){if(!parseInt(t)){var t,n=e.data("segments"),r=o(e,e.data("flickDirection"));r=="y"?t=e.height()/n:t=e.width()/n}return t}function o(e,t){t!=="x"&&t!=="y"&&(e.height()>e.width()?t="y":t="x");return t}function u(e){var r=e.timeStamp-l.start.time,i=Math.abs(Math.round(l.delta.dist.x/r*100)/100),s=Math.abs(Math.round(l.delta.dist.y/r*100)/100),o=l.delta.dir.x,u=l.delta.dir.y,a=0,f=0;i>d?Math.abs(l.delta.dist.x)>=v?a=o:a=0:s>d&&(Math.abs(l.delta.dist.y)>=v?f=u:f=0);l.end.duration=r;l.end.speed={x:i,y:s};l.end.flick={x:a,y:f};if(m){n("Touch end");t()}}function a(e){var n,r;typeof e.touches[0].pageX!="undefined"?n=e.touches[0].pageX:n=e.pageX;typeof e.touches[0].pageY!="undefined"?r=e.touches[0].pageY:r=e.pageY;var i,s,o=n,u=r,a=n-l.start.x,f=r-l.start.y;n>l.delta.prevPos.x?i=1:n<l.delta.prevPos.x?i=-1:i=0;r>l.delta.prevPos.y?s=1:r<l.delta.prevPos.y?s=-1:s=0;l.delta.prevPos={x:o,y:u};l.delta.dist={x:a,y:f};l.delta.dir={x:i,y:s};m&&t()}function f(e){var n,r;typeof e.touches[0].pageX!="undefined"?n=e.touches[0].pageX:n=e.pageX;typeof e.touches[0].pageY!="undefined"?r=e.touches[0].pageY:r=e.pageY;l=c;l.start={x:n,y:r,time:e.timeStamp};l.delta.prevPos={x:n,y:r};a(e);m&&t()}var l,c={start:{x:0,y:0,time:0},delta:{prevPos:{x:0,y:0},dist:{x:0,y:0},dir:{x:0,y:0}},end:{duration:0,speed:{x:0,y:0},flick:{x:0,y:0}}},h=!1,p=0,d=.7,v=5,m=!1,g={init:function(t){var n=e.extend({enableDebugger:!1,segments:5,snapSpeed:.3,flickSnapSpeed:.3,flickThreshold:!1,segmentPx:"auto",flickDirection:"auto",preventDefault:!0,onCreate:!1,onFlick:!1,onFlickLeft:!1,onFlickRight:!1,onFlickUp:!1,onFlickDown:!1,onScroll:!1,onScrollNext:!1,onScrollPrev:!1,onMove:!1,onStart:!1,onEnd:!1},t);return this.each(function(){var t=e(this),l=t.data("isAlive");if(!l){var c=n.segments,p=o(t,n.flickDirection);t.data("isAlive",!0).data("pos",0).data("snapSpeed",parseFloat(n.snapSpeed)).data("flickSnapSpeed",parseFloat(n.flickSnapSpeed)).data("segment",0).data("segments",c).data("flickDirection",p).data("segmentPx",s(t,n.segmentPx));e(t).bind({onStart:function(){e(this).flickable("start",n.onStart)},onMove:function(){e(this).flickable("move",n.onMove)},onEnd:function(){e(this).flickable("finished",n.onEnd)},onScroll:function(){e(this).flickable("scrollToSegment",n.onScroll)},onScrollPrev:function(){e(this).flickable("prevSegment",n.onScrollPrev)},onScrollNext:function(){e(this).flickable("nextSegment",n.onScrollNext)},onFlick:function(){e(this).flickable("flick",n.onFlick)},onFlickLeft:function(){e(this).flickable("flickLeft",n.onFlickLeft)},onFlickRight:function(){e(this).flickable("flickRight",n.onFlickRight)},onFlickUp:function(){e(this).flickable("flickUp",n.onFlickUp)},onFlickDown:function(){e(this).flickable("flickDown",n.onFlickDown)},touchstart:function(t){f(t);e(this).trigger("onStart")},touchmove:function(t){n.preventDefault&&t.preventDefault();a(t);e(this).trigger("onMove")},touchend:function(t){u(t);e(this).trigger("onEnd")}});i("transform")||(h=!0);parseInt(n.flickThreshold)&&(d=parseInt(n.flickThreshold));(m||n.enableDebugger)&&r();t.flickable("create",n.onCreate)}})},create:function(t){var r=e(this);l=c;p++;n("It's alive!");r.attr("id")||r.attr("id","flickable"+p);r.flickable("scrollToSegment");typeof t=="function"&&t.call(this,p)},start:function(t){n("Touch start");var r=e(this),i=parseInt(r.data("segment")),s=parseInt(r.data("segmentPx")),o=-(s*i);r.data("anchor",o);typeof t=="function"&&t.call(this,l)},segment:function(t){var n=e(this),r=parseInt(n.data("segments")),i=parseInt(n.data("segment"));if(typeof t!="undefined"){t>=r?t=r-1:t<0&&(t=0);t!==i?n.data("segment",t).trigger("onScroll"):n.flickable("scrollToSegment")}return parseInt(n.data("segment"))},move:function(t){var n=e(this),r,i,s=n.data("flickDirection"),o=parseInt(n.data("anchor")),r=o+l.delta.dist[s];if(h)s=="y"?n.css("top",r):n.css("left",r);else{s=="y"?i="(0,"+r+"px,0)":i="("+r+"px,0,0)";typeof document.getElementById(n.attr("id")).style.webkitTransform!="undefined"?document.getElementById(n.attr("id")).style.webkitTransform="translate3d"+i:typeof document.getElementById(n.attr("id")).style.mozTransform!="undefined"?document.getElementById(n.attr("id")).style.mozTransform="translate3d"+i:document.getElementById(n.attr("id")).style.transform="translate3d"+i}e(this).data("pos",r);typeof t=="function"&&t.call(this,l)},scrollNext:function(){e(this).trigger("onScrollNext")},scrollPrev:function(){e(this).trigger("onScrollPrev")},nextSegment:function(t){n("Next segment");var r=e(this),i=parseInt(r.data("segment"))+1;r.flickable("segment",i);typeof t=="function"&&t.call(this,l,i)},prevSegment:function(t){n("Previous segment");var r=e(this),i=parseInt(r.data("segment"))-1;r.flickable("segment",i);typeof t=="function"&&t.call(this,l,i)},flick:function(t){n("You flicked");var r=e(this);switch(l.end.flick.x){case-1:r.trigger("onFlickLeft");break;case 1:r.trigger("onFlickRight")}switch(l.end.flick.y){case-1:r.trigger("onFlickUp");break;case 1:r.trigger("onFlickDown")}typeof t=="function"&&t.call(this,l)},flickLeft:function(t){n("Flicked left");var r=e(this),i=parseInt(r.data("segment"));r.trigger("onScrollNext");typeof t=="function"&&t.call(this,l,i)},flickRight:function(t){n("Flicked right");var r=e(this),i=parseInt(r.data("segment"));r.trigger("onScrollPrev");typeof t=="function"&&t.call(this,l,i)},flickUp:function(t){n("Flicked up");var r=e(this),i=parseInt(r.data("segment"));r.trigger("onScrollNext");typeof t=="function"&&t.call(this,l,i)},flickDown:function(t){n("Flicked down");var r=e(this),i=parseInt(r.data("segment"));r.trigger("onScrollPrev");typeof t=="function"&&t.call(this,l,i)},scrollToSegment:function(t){var r=e(this),i,s=r.data("flickDirection"),o=parseFloat(r.data("snapSpeed")),u=parseFloat(r.data("flickSnapSpeed")),a=parseInt(r.data("segments")),f=parseInt(r.data("segment")),c=parseInt(r.data("segmentPx")),p=-(c*f),d="ease-out";n("Sliding to segment "+f);if(l.end.flick.x||l.end.flick.y){o=u;d="cubic-bezier(0, .70, .35, 1)"}r.data("anchor",p).data("pos",p).data("segment",f);if(h)s=="y"?r.anim({top:p},o,d):r.anim({left:p},o,d);else{s=="y"?i="0px, "+p+"px, 0px":i=p+"px, 0px, 0px";r.anim({translate3d:i},o,d)}typeof t=="function"&&t.call(this,l,f)},finished:function(t){var r=e(this),i=r.data("flickDirection"),s=parseInt(r.data("segments")),o=parseInt(r.data("segment")),u=parseInt(r.data("segmentPx")),a=parseInt(r.data("anchor")),f=parseInt(r.data("pos")),c;f<0?c=Math.abs(Math.round(f/u)):c=0;n("Nearest segment is "+c);typeof t=="function"&&t.call(this,l,o);if(o==c&&l.end.flick[i])return r.trigger("onFlick");c==o+1?r.trigger("onScrollNext"):c==o-1?r.trigger("onScrollPrev"):r.flickable("segment",c)}};e.fn.flickable=function(t){if(g[t])return g[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return g.init.apply(this,arguments);e.error("Method "+t+" does not exist")}})(Zepto);$(document).ready(function(e){$(".module .col-header").onpress(function(){$(".module").toggleClass("module--closed");$(this).parents(".module").toggleClass("module--open").removeClass("module--closed")});$(".m-play-button").onpress(function(){$(this).toggleClass("module--hold")})});